#!/bin/bash

set -ex

# make sure to be in the resource dir
cd "${1}"

exec 3>&1 # make stdout available as fd 3 for the result
exec 1>&2 # redirect all output to stderr for logging

set +x

source _base
source _projects

### Extra Param Configuration
CLONE="$(jq -r '.params.clone // "false"' < "${payload}")"
source _clone

PROJECTLIST=$(cat projects.json | jq -r .projects[].path | xargs)
VERSION="$(echo $PROJECTLIST | md5sum | cut -d ' ' -f 1)"
echo "[{\"version\":{\"version:\":\"$VERSION\"}, \"metadata\": [{\"name\": \"projects\", \"value\": \"$PROJECTLIST\"}]" | jq -s add  >&3